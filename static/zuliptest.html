<html>

<head>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
	<script type="text/javascript" src="zuliptest.js"></script>
	<script type="text/javascript">
		function send_message() {
			var msg_box = $('#message_out');
			var username = username_box.val();
			var message = '';
			if (username) {
				message += '<' + username + '> ';
			}
			var page = page_box.val();
			var topic = 'Test';
			if (page) {
				topic = page;
			}
			message += msg_box.val();
			QUEBECOIS.send('puzzles', topic, message);
			msg_box.val('');
		}
	</script>
</head>

<body>
	<form action='#' onsubmit='send_message(); return false;'>
		<input type='text' name='username' id='username' placeholder='username'>
		<input type='text' name='page' id='page' placeholder='page'>
		<div id='messages' style='width: 100%; overflow: auto'></div>
		<input type='text' name='message_out' id='message_out'>
		<input type='submit' name='submit' value='Send'>
	</form>
	<script type="text/javascript">
		var username_box = $('#username');
		if (parms['user']) {
			username_box.val(parms['user']);
		}
		var page_box = $('#page');
		if (parms['page']) {
			page_box.val(parms['page']);
		}

		$('#messages').css({'height': '170px'});

		QUEBECOIS.go('puzzles', page_box.val(), function(e) {
			console.log("GOT EVENT", e);
			var sender = e.message.sender_full_name;
			var content = e.message.content;
			var message = '';
			if (e.message.sender_email == BOT_EMAIL) {
				message = content;
			} else {
				message = '[' + sender + '] ' + content;
			}

			var msg_div = $('<div>');
			var messages_div = $('#messages');
			var at_bottom = messages_div[0].scrollHeight - messages_div.scrollTop() == messages_div.outerHeight()
			msg_div.text(message);
			messages_div.append(msg_div);
			if (at_bottom) {
				messages_div.scrollTop(messages_div[0].scrollHeight);
			}
		});
	</script>
</body>

</html>
